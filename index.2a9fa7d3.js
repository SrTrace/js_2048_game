!function(){var t={};function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function n(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,void 0);var r=Object.prototype.toString.call(t).slice(8,-1);if("Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}t=function(){var t;function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e),this.initialState=t,this.state=this.initialState.map(function(t){return n(t)}),this.hasMoved=!1,this.status="idle",this.score=0}return t=[{key:"moveLeft",value:function(){if("playing"===this.status)return this.makeMove("left")}},{key:"moveRight",value:function(){if("playing"===this.status)return this.makeMove("right")}},{key:"moveUp",value:function(){if("playing"===this.status)return this.makeMove("up")}},{key:"moveDown",value:function(){if("playing"===this.status)return this.makeMove("down")}},{key:"makeMove",value:function(t){return this.hasMoved=this.moveLines(t),!!this.hasMoved&&(this.generateNewCell(),this.hasMoved=!1,this.getStatus(),!0)}},{key:"moveLines",value:function(t){for(var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{precededCheckMove:!1}).precededCheckMove,n=this.state.length,r="up"===t||"down"===t,i=e?this.getStateCopy():this.state,s=this.getStateCopy(),o=0;o<n;o++){for(var a=[],u=0;u<n;u++)a.push(r?this.state[u][o]:this.state[o][u]);for(var l=this.mergeLine(a,t,{precededCheckMove:e}),c=0;c<n;c++)r?i[c][o]=l[c]:i[o][c]=l[c]}return this.isMove(s,i)}},{key:"isMove",value:function(t,e){for(var n=0;n<t.length;n++)for(var r=0;r<t.length;r++)if(t[n][r]!==e[n][r])return!0;return!1}},{key:"mergeLine",value:function(t,e,n){for(var r=n.precededCheckMove,i=t.length,s=[],o=Array(i).fill(0),a="up"===e||"left"===e?0:i-1,u="up"===e||"left"===e?i:-1,l="up"===e||"left"===e?1:-1,c=a,h=a;h!==u;h+=l){var f=t[h];if(0!==f){if(0===s.length)s.push(f);else if(s[0]===f){var v=+s[0]+ +f;o[c]=s.pop()+f,c+=l,r||(this.score+=v)}else o[c]=s.pop(),c+=l,s.push(f)}}return s.length>0&&(o[c]=s.pop()),o}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.state}},{key:"getStateCopy",value:function(){return this.state.map(function(t){return n(t)})}},{key:"getStatus",value:function(){return this.checkWin()?this.status="win":"playing"!==this.status||this.hasMoreMove()||(this.status="lose"),this.status}},{key:"checkWin",value:function(){return this.state.some(function(t){return t.includes(2048)})}},{key:"start",value:function(){this.status="playing",this.generateNewCell(),this.generateNewCell()}},{key:"restart",value:function(){this.state=this.initialState.map(function(t){return n(t)}),this.status="idle",this.score=0}},{key:"updateField",value:function(t){for(var e=0;e<t.rows.length;e++)for(var n=0;n<t.rows[e].cells.length;n++){var r=this.state[e][n];t.rows[e].cells[n].textContent=0!==r?r:"",""!==r&&t.rows[e].cells[n].setAttribute("class","field-cell field-cell--".concat(r))}var i=document.createDocumentFragment();return Array.from(t.rows).forEach(function(t){return i.appendChild(t)}),i}},{key:"generateNewCell",value:function(){for(var t=this.state,e=[],n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)0===t[n][r]&&e.push({row:n,cell:r});if(!e.length)return this.getStatus(),!1;var i=Math.floor(Math.random()*e.length),s=e[i],o=s.row,a=s.cell;this.state[o][a]=.1>Math.random()?4:2}},{key:"hasMoreMove",value:function(){return this.moveLines("up",{precededCheckMove:!0})||this.moveLines("down",{precededCheckMove:!0})||this.moveLines("left",{precededCheckMove:!0})||this.moveLines("right",{precededCheckMove:!0})}}],function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,t),e}();var r=document.querySelector(".game-field tbody"),i=document.querySelector(".start"),s=document.querySelectorAll(".message"),o=document.querySelector(".game-score"),a={start:"message-start",win:"message-win",lose:"message-lose"},u=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],l=new t(u),c=!0,h=!1;function f(t){s.forEach(function(e){e.classList.contains(t)?e.classList.remove("hidden"):e.classList.add("hidden")})}function v(t){o.textContent=t}function d(){var t=l.updateField(r);r.appendChild(t)}function p(t){t?(i.classList.remove("start"),i.classList.add("restart"),i.textContent="Restart"):(i.classList.remove("restart"),i.classList.add("start"),i.textContent="Start")}i.addEventListener("click",function(){"Start"===i.textContent&&((h=!h)?l.start():((l=new t(u)).start(),h=!0),f(null),v(l.getScore()),d()),"Restart"===i.textContent&&(l.restart(),p(!1),c=!0,f(a.start),v(l.getScore()),d())}),document.addEventListener("keydown",function(t){if("idle"===l.status)return!1;if("playing"===l.status){var e={ArrowUp:function(){return l.moveUp()},ArrowRight:function(){return l.moveRight()},ArrowDown:function(){return l.moveDown()},ArrowLeft:function(){return l.moveLeft()}}[t.key];e&&e()&&d()}c&&(p(!0),c=!1),v(l.getScore()),"win"===l.status&&f(a.win),"lose"===l.status&&f(a.lose)})}();
//# sourceMappingURL=index.2a9fa7d3.js.map
