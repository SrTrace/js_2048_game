var t={};t=class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.state=this.initialState.map(t=>[...t]),this.hasMoved=!1,this.status="idle",this.score=0}moveLeft(){if("playing"===this.status)return this.makeMove("left")}moveRight(){if("playing"===this.status)return this.makeMove("right")}moveUp(){if("playing"===this.status)return this.makeMove("up")}moveDown(){if("playing"===this.status)return this.makeMove("down")}makeMove(t){return this.hasMoved=this.moveLines(t),!!this.hasMoved&&(this.generateNewCell(),this.hasMoved=!1,this.getStatus(),!0)}moveLines(t,{precededCheckMove:e}={precededCheckMove:!1}){let s=this.state.length,r="up"===t||"down"===t,i=e?this.getStateCopy():this.state,o=this.getStateCopy();for(let o=0;o<s;o++){let a=[];for(let t=0;t<s;t++)a.push(r?this.state[t][o]:this.state[o][t]);let n=this.mergeLine(a,t,{precededCheckMove:e});for(let t=0;t<s;t++)r?i[t][o]=n[t]:i[o][t]=n[t]}return this.isMove(o,i)}isMove(t,e){for(let s=0;s<t.length;s++)for(let r=0;r<t.length;r++)if(t[s][r]!==e[s][r])return!0;return!1}mergeLine(t,e,{precededCheckMove:s}){let r=t.length,i=[],o=Array(r).fill(0),a="up"===e||"left"===e?0:r-1,n="up"===e||"left"===e?r:-1,l="up"===e||"left"===e?1:-1,h=a;for(let e=a;e!==n;e+=l){let r=t[e];if(0!==r){if(0===i.length)i.push(r);else if(i[0]===r){let t=+i[0]+ +r;o[h]=i.pop()+r,h+=l,s||(this.score+=t)}else o[h]=i.pop(),h+=l,i.push(r)}}return i.length>0&&(o[h]=i.pop()),o}getScore(){return this.score}getState(){return this.state}getStateCopy(){return this.state.map(t=>[...t])}getStatus(){return this.checkWin()?this.status="win":"playing"!==this.status||this.hasMoreMove()||(this.status="lose"),this.status}checkWin(){return this.state.some(t=>t.includes(2048))}start(){this.status="playing",this.generateNewCell(),this.generateNewCell()}restart(){this.state=this.initialState.map(t=>[...t]),this.status="idle",this.score=0}updateField(t){for(let e=0;e<t.rows.length;e++)for(let s=0;s<t.rows[e].cells.length;s++){let r=this.state[e][s];t.rows[e].cells[s].textContent=0!==r?r:"",""!==r&&t.rows[e].cells[s].setAttribute("class",`field-cell field-cell--${r}`)}let e=document.createDocumentFragment();return Array.from(t.rows).forEach(t=>e.appendChild(t)),e}generateNewCell(){let t=this.state,e=[];for(let s=0;s<t.length;s++)for(let r=0;r<t[s].length;r++)0===t[s][r]&&e.push({row:s,cell:r});if(!e.length)return this.getStatus(),!1;let s=Math.floor(Math.random()*e.length),{row:r,cell:i}=e[s];this.state[r][i]=.1>Math.random()?4:2}hasMoreMove(){return this.moveLines("up",{precededCheckMove:!0})||this.moveLines("down",{precededCheckMove:!0})||this.moveLines("left",{precededCheckMove:!0})||this.moveLines("right",{precededCheckMove:!0})}};const e=document.querySelector(".game-field tbody"),s=document.querySelector(".start"),r=document.querySelectorAll(".message"),i=document.querySelector(".game-score"),o={start:"message-start",win:"message-win",lose:"message-lose"},a=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];let n=new t(a),l=!0,h=!1;function c(t){r.forEach(e=>{e.classList.contains(t)?e.classList.remove("hidden"):e.classList.add("hidden")})}function u(t){i.textContent=t}function d(){let t=n.updateField(e);e.appendChild(t)}function g(t){t?(s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart"):(s.classList.remove("restart"),s.classList.add("start"),s.textContent="Start")}s.addEventListener("click",()=>{"Start"===s.textContent&&((h=!h)?n.start():((n=new t(a)).start(),h=!0),c(null),u(n.getScore()),d()),"Restart"===s.textContent&&(n.restart(),g(!1),l=!0,c(o.start),u(n.getScore()),d())}),document.addEventListener("keydown",t=>{if("idle"===n.status)return!1;if("playing"===n.status){let e={ArrowUp:()=>n.moveUp(),ArrowRight:()=>n.moveRight(),ArrowDown:()=>n.moveDown(),ArrowLeft:()=>n.moveLeft()}[t.key];e&&e()&&d()}l&&(g(!0),l=!1),u(n.getScore()),"win"===n.status&&c(o.win),"lose"===n.status&&c(o.lose)});
//# sourceMappingURL=index.4d03548e.js.map
